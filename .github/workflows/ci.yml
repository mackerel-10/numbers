name: Test

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest

    # Service containers to run with `container-job`
    services:
      # Label used to access the service container
      mysql:
        # Docker Hub image
        image: mysql:8.4.0
        env:
            MYSQL_ROOT_PASSWORD: ${{secrets.MYSQL_ROOT_PASSWORD}}
            MYSQL_DATABASE: ${{secrets.MYSQL_DATABASE}}
            MYSQL_USER: ${{secrets.MYSQL_USER}}
            MYSQL_PASSWORD: ${{secrets.MYSQL_PASSWORD}}

    steps:
      - name: Checkout repository code
        uses: actions/checkout@v2
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
            node-version: '20'
      - name: Install dependencies
        run: npm ci
      - name: Run tests
        run: |
          npm run lint
          npm test
        env:
          SKIP_ENV_TEST: true
          PORT: ${{secrets.PORT}}
          MYSQL_HOST: ${{secrets.MYSQL_HOST}}
          MYSQL_PORT: ${{secrets.MYSQL_PORT}}
          MYSQL_DATABASE: ${{secrets.MYSQL_DATABASE}}
          MYSQL_USER: ${{secrets.MYSQL_USER}}
          MYSQL_PASSWORD: ${{secrets.MYSQL_PASSWORD}}

